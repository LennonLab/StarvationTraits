---
title: "14C Respiration/Production Methods"
author: "Mario Muscarella"
date: "`r format(Sys.time(), '%d %B, %Y')`"
header-includes:
   - \usepackage{array}
   - \usepackage{graphics}
output: 
  pdf_document:
    fig_caption: true
geometry: margin=2.54cm
---

```{r, echo=FALSE, results='hide'}
rm(list=ls())
setwd("~/GitHub/StarvationTraits/notes/")
se <- function(x, ...){sd(x, na.rm = TRUE)/sqrt(length(na.omit(x)))}
```

# Overview

The simultaneous measurement of bacterial respiration and production will give the best results for estimating growth efficiency.
Here, we have constructed custom bacterial respiration/production vials (Fig 1).
We will use these vials with 14C-resources.
However, first we must optimize the methods.

```{r fig.width=2, fig.height=2,echo=FALSE,fig.cap="Bacterial Respiration and Production Vial"}
library(png)
library(grid)
img <- readPNG("../figures/C14Tube.png")
 grid.raster(img)
```

# Optimizations

As we start there are a few things we need to optimize.
We are going to start by determining the efficiency of our apparatus. 
We are doing this using 14C-Bicarbonate.
But we need to check a few things first:

1. How much Bicarbonate should we add
2. What is the efficiency of the trap

## 1) Bicarbonate

I did a simple experiment where I added known volumes of the bicarbonate stock to 1500 $\mu$L of scintillation cocktail (1, 5, and 10 $\mu$L).
Based on this I discovered that the LSC could only measure 1 $\mu$L max.
The CPM for this voucher was ~2,300,000 cpm.

## 2) Trap Efficiency

```{r, results='hide'}
# Import Data
trap.data <- read.csv("../notes/20150921_BRBP.csv", header=T)

# Raw Data For Intra Vial Test
in1  <- trap.data[trap.data$Sample == "Tube1_in" & trap.data$Time == "1", 3]
out1 <- trap.data[trap.data$Sample == "Tube1_out" & trap.data$Time == "1", 3]

# Define Theoretical Value
voucher <- trap.data[trap.data$Sample == "Voucher" & trap.data$Time == "1", 3]

# Correct For Vol
in1.c <- in1 * 5 # used 100ul of 500ul
out1.c <- out1 * 50 # used 100ul of 5000ul

# Percent of Theoretical
in1.p <- in1.c / voucher
out1.p <- out1.c / voucher

# Calculate mean and sem
means <- c("Trap" = mean(in1.p), "Residual" = mean(out1.p))
ses <- c("Trap" = se(in1.p), "Residual" = se(out1.p))

# Plot
png(filename="../figures/Recovery1.png",
    width = 800, height = 800, res = 96*2)

par(mar=c(3,5,0.5,0.5), oma=c(1,1,1,1)+0.1, lwd=2)
bp_plot <- barplot(means, ylab = "Percent Recovery", 
                   ylim = c(0, 1), lwd=3, yaxt="n", col="gray",
                   cex.lab=1.5, cex.names = 1.25)
arrows(x0 = bp_plot, y0 = means, y1 = means - ses, angle = 90,
       length=0.1, lwd = 2)
arrows(x0 = bp_plot, y0 = means, y1 = means + ses, angle = 90,
       length=0.1, lwd = 2)
axis(side = 2, labels=T, lwd.ticks=2, las=2, lwd=2)

dev.off() # this writes plot to folder
graphics.off() # shuts down open devices
```

```{r fig.width=4, fig.height=4,echo=FALSE,fig.cap="14C-Bicarbonate Recovery"}
library(png)
library(grid)
img <- readPNG("../figures/Recovery1.png")
 grid.raster(img)
```

## 3) Alkaline Solution Experiment
One thing that we need to test is if if matters what alkaline solution we use (NaOH or KOH) and at what concentration. 
So we are going to do a simple experiment to test this.
I filled 21 BP vials with 1500 $\mu$L scintillation cocktail.
I then added 100 $\mu$L of either NaOH or KOH at either 5N, 1N, or 0.1N.
I then added 1 $\mu$L of 14C-Bicarbonate.
I analyzed on the LSC immediately.

```{r}
# Import Data
alk.data <- read.csv("../notes/20150924_AlkalineExp.csv", header=T)
alk.data$Group <- sapply(strsplit(as.character(alk.data$Sample), "OH"), "[[", 1)

pairwise.t.test(alk.data$CPM, alk.data$Group, p.adjust.method="BH")
alk.model <- lm(alk.data$CPM ~ alk.data$Group + alk.data$Sample)

# Group Differences
round(TukeyHSD(aov(alk.model))$'alk.data$Group', 4)

# Make Dateframe for Plotting
alk.data.plot <- as.data.frame(matrix(NA, length(levels(alk.data$Sample)), 5))
colnames(alk.data.plot) <- c("Sample", "Group", "Normality", "mean", "sem")
alk.data.plot$Sample <- rev(levels(alk.data$Sample))
alk.data.plot$Group <- sapply(strsplit(alk.data.plot$Sample, "OH"), "[[", 1)
alk.data.plot$Group[2:7] <- paste(alk.data.plot$Group[2:7], "OH", sep="")
alk.data.plot$Normality[2:7] <- sapply(strsplit(alk.data.plot$Sample[2:7], "OH"), "[[", 2)

for (i in alk.data.plot$Sample){
  alk.data.plot$mean[alk.data.plot$Sample == i] <- mean(alk.data$CPM[alk.data$Sample == i])
}

for (i in alk.data.plot$Sample){
  alk.data.plot$sem[alk.data.plot$Sample == i] <- se(alk.data$CPM[alk.data$Sample == i])
}

# Plot
png(filename="../figures/Alkalinity.png",
    width = 1600, height = 1200, res = 96*2)

par(mar=c(4,5,0.5,0.5), oma=c(1,1,1,1)+0.1, lwd=2)
bp_plot <- barplot(alk.data.plot$mean / 1000000, ylab = "Counts Per Minute (millions)", 
                   names.arg = alk.data.plot$Normality,
                   space = c(0, 0.5, 0, 0, 0.5, 0, 0),
                   lwd=3, yaxt="n", col="gray", ylim = c(0, 2.5),
                   cex.lab=1.5, cex.names = 1.25)
arrows(x0 = bp_plot, y0 = alk.data.plot$mean / 1000000, 
       y1 = alk.data.plot$mean / 1000000 - alk.data.plot$sem / 1000000, angle = 90,
       length=0.1, lwd = 2)
arrows(x0 = bp_plot, y0 = alk.data.plot$mean / 1000000, 
       y1 = alk.data.plot$mean / 1000000 + alk.data.plot$sem / 1000000, angle = 90,
       length=0.1, lwd = 2)
axis(side = 2, labels=T, lwd.ticks=2, las=2, lwd=2)
mtext(alk.data.plot$Group[c(1,3,6)], side = 1, at=bp_plot[c(1,3,6)], line = 2.5, cex=1.5)

dev.off() # this writes plot to folder
graphics.off() # shuts down open devices 
 
 
 
```
 
 
 
